<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hexagonalness Metrics - Fish Scale Measurement</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --text-muted: #64748b;
            --border-color: #e2e8f0;
            --good-color: #16a34a;
            --medium-color: #ca8a04;
            --poor-color: #dc2626;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        h1 { color: var(--primary-color); margin-bottom: 0.5rem; }
        h2 {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        h3 {
            color: var(--primary-color);
            margin-top: 1.5rem;
        }
        .section {
            background: white;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }
        code {
            background: #f1f5f9;
            padding: 0.125rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
        }
        a {
            color: var(--primary-color);
        }
        .param-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        .param-range {
            color: var(--text-muted);
            font-size: 0.9em;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 1rem;
            color: var(--text-muted);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        th {
            background: var(--bg-color);
            font-weight: 600;
        }
        .score-good { color: var(--good-color); font-weight: 600; }
        .score-medium { color: var(--medium-color); font-weight: 600; }
        .score-poor { color: var(--poor-color); font-weight: 600; }
        .formula {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            overflow-x: auto;
        }
        .note {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <a href="javascript:window.close()" class="back-link">Close</a>
    <h1>Hexagonalness Metrics</h1>
    <p>These metrics measure how well the detected tubercle pattern matches an ideal hexagonal lattice, which is the natural arrangement observed in fish scales.</p>

    <h2 id="overview">Overview</h2>

    <div class="section">
        <p>In an ideal hexagonal lattice:</p>
        <ul>
            <li>Each interior node has exactly <strong>6 neighbors</strong></li>
            <li>All edge lengths are <strong>equal</strong> (uniform spacing)</li>
            <li>Angles between edges are <strong>60 degrees</strong></li>
            <li>Edge count is approximately <strong>3 times</strong> the node count</li>
        </ul>
        <p>Real fish scale patterns deviate from this ideal due to biological variation, image quality, and edge effects (nodes near the image boundary have fewer neighbors).</p>
    </div>

    <h2 id="hexagonalness">Hexagonalness Score</h2>

    <div class="section" id="hexagonalness">
        <h3 class="param-name">Hexagonalness Score</h3>
        <p class="param-range">Range: 0.0 - 1.0</p>
        <p>A composite score measuring overall pattern quality. Higher is better.</p>

        <table>
            <tr>
                <th>Score</th>
                <th>Quality</th>
                <th>Interpretation</th>
            </tr>
            <tr>
                <td class="score-good">0.70 - 1.00</td>
                <td>Good</td>
                <td>Well-formed hexagonal pattern with uniform spacing</td>
            </tr>
            <tr>
                <td class="score-medium">0.40 - 0.69</td>
                <td>Medium</td>
                <td>Partially hexagonal pattern, some irregularities</td>
            </tr>
            <tr>
                <td class="score-poor">0.00 - 0.39</td>
                <td>Poor</td>
                <td>Pattern deviates significantly from hexagonal, may need adjustment</td>
            </tr>
        </table>

        <p>The score is calculated as a weighted combination of three component scores:</p>
        <div class="formula">
Hexagonalness = 0.40 × Spacing Uniformity + 0.45 × Degree Score + 0.15 × Edge Ratio Score
        </div>
    </div>

    <h2 id="components">Formula Components</h2>
    <p>These three scores are combined with the weights shown to calculate the Hexagonalness score.</p>

    <div class="section" id="spacing-uniformity">
        <h3 class="param-name">Spacing Uniformity <span class="param-range">(40% weight)</span></h3>
        <p class="param-range">Range: 0.0 - 1.0 (higher is better)</p>
        <p>Measures how uniform the edge lengths (intertubercular spaces) are. A perfect hexagonal grid has identical edge lengths.</p>
        <div class="formula">
Spacing Uniformity = max(0, 1 - 2 × CV)
        </div>
        <p>Where CV (Coefficient of Variation) = std_dev(edge_lengths) / mean(edge_lengths)</p>
        <ul>
            <li><strong>1.0:</strong> Perfect uniformity (CV = 0)</li>
            <li><strong>0.5:</strong> Moderate variation (CV = 0.25)</li>
            <li><strong>0.0:</strong> High variation (CV ≥ 0.5)</li>
        </ul>
    </div>

    <div class="section" id="degree-score">
        <h3 class="param-name">Degree Score <span class="param-range">(45% weight)</span></h3>
        <p class="param-range">Range: 0.0 - 1.0 (higher is better)</p>
        <p>Weighted fraction of nodes with appropriate neighbor counts for a hexagonal lattice.</p>
        <table>
            <tr>
                <th>Neighbors</th>
                <th>Weight</th>
                <th>Interpretation</th>
            </tr>
            <tr>
                <td>5, 6, 7</td>
                <td>1.0</td>
                <td>Ideal range for hex lattice</td>
            </tr>
            <tr>
                <td>4, 8</td>
                <td>0.7</td>
                <td>Acceptable (edge nodes or slight variation)</td>
            </tr>
            <tr>
                <td>3, 9</td>
                <td>0.3</td>
                <td>Marginal (corner nodes or irregular)</td>
            </tr>
            <tr>
                <td>0-2, 10+</td>
                <td>0.0</td>
                <td>Problematic (isolated or over-connected)</td>
            </tr>
        </table>
    </div>

    <div class="section" id="edge-ratio-score">
        <h3 class="param-name">Edge Ratio Score <span class="param-range">(15% weight)</span></h3>
        <p class="param-range">Range: 0.0 - 1.0 (higher is better)</p>
        <p>Measures how close the edge-to-node ratio is to the ideal value for a hexagonal lattice.</p>
        <div class="formula">
Edge Ratio Score = max(0, 1 - |ratio - 2.5| / 2)
        </div>
        <p>Where ratio = number_of_edges / number_of_nodes</p>
        <ul>
            <li><strong>Ideal ratio:</strong> ~2.5 (accounting for boundary effects)</li>
            <li><strong>Perfect interior hex:</strong> ratio = 3 (each node has 6 edges, shared between 2 nodes)</li>
            <li><strong>Typical samples:</strong> ratio 2.0-3.0 depending on boundary proportion</li>
        </ul>
    </div>

    <h2 id="raw-metrics">Supporting Metrics</h2>
    <p>These raw values provide additional insight but are not directly used in the formula.</p>

    <div class="section" id="spacing-cv">
        <h3 class="param-name">Spacing CV (Coefficient of Variation)</h3>
        <p class="param-range">Range: 0.0+ (lower is better)</p>
        <p>The raw coefficient of variation of edge lengths, used to calculate Spacing Uniformity.</p>
        <div class="formula">
CV = standard_deviation(edge_lengths) / mean(edge_lengths)
        </div>
        <ul>
            <li><strong>CV &lt; 0.25:</strong> Very uniform spacing → Spacing Uniformity &gt; 0.5</li>
            <li><strong>CV 0.25 - 0.50:</strong> Moderate variation → Spacing Uniformity 0.0 - 0.5</li>
            <li><strong>CV &gt; 0.50:</strong> High variation → Spacing Uniformity = 0</li>
        </ul>
    </div>

    <div class="section" id="mean-degree">
        <h3 class="param-name">Mean Degree</h3>
        <p class="param-range">Typical range: 3.0 - 6.0</p>
        <p>Average number of connections (neighbors) per node. Provides context for interpreting Degree Score.</p>
        <ul>
            <li><strong>Interior nodes</strong> in a perfect hex lattice: 6 neighbors</li>
            <li><strong>Edge nodes</strong>: 3-5 neighbors (fewer due to boundary effects)</li>
            <li><strong>Expected mean:</strong> ~4-5 for typical samples</li>
        </ul>
        <p>Very low (&lt; 3) may indicate missing connections. Very high (&gt; 7) may indicate over-connection.</p>
    </div>

    <h2 id="reliability">Reliability Indicator</h2>

    <div class="section">
        <h3 class="param-name">Reliability</h3>
        <p>Indicates statistical confidence in the hexagonalness metrics.</p>
        <table>
            <tr>
                <th>Level</th>
                <th>Node Count</th>
                <th>Meaning</th>
            </tr>
            <tr>
                <td><strong>High</strong></td>
                <td>15+ nodes</td>
                <td>Statistically reliable metrics</td>
            </tr>
            <tr>
                <td><strong>Low</strong></td>
                <td>4-14 nodes</td>
                <td>Metrics may be unreliable due to small sample size</td>
            </tr>
            <tr>
                <td><strong>None</strong></td>
                <td>&lt; 4 nodes</td>
                <td>Insufficient data for calculation</td>
            </tr>
        </table>

        <div class="note">
            <strong>Note:</strong> With fewer than 15 nodes, the hexagonalness score may be artificially high or low due to random variation. Use caution when interpreting scores from small samples.
        </div>
    </div>

    <h2 id="usage">Practical Usage</h2>

    <div class="section">
        <h3>Improving Hexagonalness</h3>
        <p>If the hexagonalness score is low, consider:</p>
        <ol>
            <li><strong>Check detection parameters:</strong> Adjust threshold, diameter range, or circularity to improve tubercle detection</li>
            <li><strong>Remove false positives:</strong> Delete incorrectly detected nodes (noise, artifacts)</li>
            <li><strong>Add missing nodes:</strong> Manually add obvious tubercles that were missed</li>
            <li><strong>Regenerate connections:</strong> Try a different graph type (Gabriel, RNG) to get better neighbor relationships</li>
            <li><strong>Review image quality:</strong> Poor contrast or focus can affect detection accuracy</li>
        </ol>

        <h3>When to Use</h3>
        <p>The hexagonalness score is useful for:</p>
        <ul>
            <li>Comparing different parameter settings objectively</li>
            <li>Validating automatic detection quality</li>
            <li>Deciding when manual cleanup is needed</li>
            <li>Assessing pattern regularity across specimens</li>
        </ul>
    </div>
</body>
</html>
